digraph G {
    rankdir="TD";
    graph [pad="0.5", nodesep="1", ranksep="2"];
    overlap=false;
    splines=true;
    
    subgraph cluster_0 {
        style=solid;
		color=black;
        bgcolor=darkolivegreen2;

		node [
            style=filled,
            color=darkolivegreen4, 
            shape=rect,
            fontcolor=white
        ];
        
        CCR;
        CPB;
        CPBP;
        CPR;
        CP;
        KMSK;

        ACCOUNT_NON_PRODUCTION;
    }

    subgraph cluster_1 {
 
        style=solid;
		color=black;
        bgcolor=deepskyblue1;

		node [
            style=filled,
            color=dodgerblue4, 
            shape=rect,
            fontcolor=white
        ];

        CFAR;
        CFDR;

        ACCOUNT_PRODUCTION;
    }

    // Node relationships

    ACCOUNT_PRODUCTION -> KMSK [label="Grants access to\nProduction Account"];
    CCR -> CP [label="Source Action"];
    CFAR -> CFDR [label="Deploys cross-account CloudFormation\ntemplates under this role"];
    CFAR -> CPBP [label="Granted Access"];
    CFDR -> CPBP [label="Granted Access"];
    CP -> CFAR [label="Executes cross-account\nCloudFormation action as this role"];
    CP -> CFDR [label="CloudFormation is\nexecuted as this role"];
    CP -> CPB [label="Source Artefact"];
    CPB -> CFAR [label="Reads source CloudFormation\ntemplate from bucket"]
    CPB -> CFDR [label="Reads source CloudFormation\ntemplate from bucket"]
    CPR -> CFAR [label="Allows to assume\ncross-account role"];
    CPR -> CP [label="Service Role"];
    CPR -> CPBP [label="Granted Access"];
    KMSK -> CFAR [label="Required to access\nfiles in bucket"]
    KMSK -> CPB [label="Encryption at rest"];

    // Node configurations

    ACCOUNT_NON_PRODUCTION [label="Non-Production Account", shape=rectangle];
    CCR [label="CodeCommitRepository", shape=trapezium];
    CPB [label="CodePipelineBucket", shape=octagon];
    CPBP [label="CodePipelineBucketPolicy", shape=doubleoctagon];
    CPR [label="CodePipelineRole", shape=septagon];
    CP [label="CodePipeline", shape=house];
    KMSK [label="KMSKey", shape=diamond];

    ACCOUNT_PRODUCTION [label="Production Account", shape=rectangle];
    CFAR [label="CloudFormationAssumeRole", shape=septagon];
    CFDR [label="CloudFormationDeployerRole", shape=septagon];
} 